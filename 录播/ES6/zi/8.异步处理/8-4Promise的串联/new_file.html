<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Promise串联训练</title>
		<meta name="viewport"
			content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	</head>

	<body>

		<script type="text/javascript">
			// 买保险 => 卖出一份		1. 客户骂人  2. 客户买 

			let i = 1;

			function Insurance(customerName) {
				return new Promise((resolve, reject) => {
					console.log(`正在向客户${customerName}发送消息！！！`);
					console.log("===== 消息已发送 =====");
					const counter = Math.random();
					if (counter < 0.1) {
						console.log("已经卖出一份，停止售卖，开始跑路 ~ ~ ~");
						resolve(true);
					} else if (counter >= 0.1 && counter < 0.8) {
						console.log("没有卖出，继续售卖 ~ ~ ~");
						resolve(false);
					} else {
						console.log(`客户${customerName}骂人`);
						reject(`${customerName}`);
					}
				})
			}
			Insurance(`客户${i ++}`).then(result => {
				if(result) {
					return;
				} else {
					Insurance(`客户${i ++}`).then(result => {
						if(result) {
							return;
						} else {
							Insurance(`客户${i ++}`).then(result => {
								if(result) {
									return;
								} else {
									Insurance(`客户${i ++}`).then(result => {
										if(result) {
											return;
										} else {
											Insurance(`客户${i ++}`).then(result => {
												if(result) {
													return;
												} else {
													Insurance(`客户${i ++}`).then(result => {
														if(result) {
															return;
														} else {
															Insurance(`客户${i ++}`).then(result => {
																if(result) {
																	return;
																} else {
																	console.log("所有客户都已售卖");
																}
															}, err => {
																console.log(`问候客户${err}的双亲`);
															})
														}
													}, err => {
														console.log(`问候客户${err}的双亲`);
													})
												}
											}, err => {
												console.log(`问候客户${err}的双亲`);
											})
										}
									}, err => {
										console.log(`问候客户${err}的双亲`);
									})
								}
							}, err => {
								console.log(`问候客户${err}的双亲`);
							})
						}
					}, err => {
						console.log(`问候客户${err}的双亲`);
					})
				}
			}, err => {
				console.log(`问候客户${err}的双亲`);
			})
		</script>

	</body>

</html>
